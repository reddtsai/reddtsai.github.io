[{"content":"Hello，大家好我是Redd，是位後端軟體工程師(Backend Engineer)，在此與大家分享自己後端的工作經驗。\n","description":"about page of Redd's side project","id":0,"section":"","tags":null,"title":"About","uri":"https://reddtsai.github.io/zh/about/"},{"content":"What are microservices 微服務是一個軟體架構，是一種將應用程式建構成服務集合的結構樣式。微服務架構的理念為『各司其職，各安其位，善盡本分』。\nWhy 微服務不是救世主，\nHow DDD\n溝通\n參考來源 Microservices Architecture\n","description":"","id":1,"section":"posts","tags":["microservice"],"title":"開始使用微服務","uri":"https://reddtsai.github.io/zh/posts/microservice/"},{"content":"Elastic 提供一個強大的 UI 介面 Kibana，透過它能更有效的分享與呈現 Elasticsearch 中的數據，接下來會以本身使用的案例，來介紹如何使用 Kibana。\n 版本\n Kibana 6  安裝請參考下一篇文章CentOS 7 如何安裝 Kibana\n Discover Page 數據探索功能，使用 Elasticsearch Index、Time Range 和 Query DSL 過濾搜索，顯示數據計數和內䆟\n 注意\n如果遇到 no cached mapping for this field\n試著在 Management，Refresh field list\n Dashboard Page 儀表版功能，Kibana 提供多樣視覺化圖表，儀表版可幫助你收集管理這些圖表\nLogs Page 數據功能，顯示匯入的數據\nQuery DSL Elastic 提供了一套查詢語法 DSL (Domain Specific Language)，可透過 RESTful 或 Kibana 的介面來使用，這邊介紹幾個範例\n  Match\n例如查詢 IIS 中，有那些 Request 回應 500\n GET /_search { \u0026quot;query\u0026quot;: { \u0026quot;match\u0026quot;: { \u0026quot;iis.access.response_code\u0026quot;: { \u0026quot;query\u0026quot;: 500, \u0026quot;type\u0026quot;: \u0026quot;phrase\u0026quot; } } } }    Wildcard\n例如查詢 IIS 中，有那些 Request url like */app/\n GET /_search { \u0026quot;query\u0026quot;: { \u0026quot;wildcard\u0026quot;: { \u0026quot;iis.access.url\u0026quot;: \u0026quot;*/app\u0026quot; } } }    Prefix\n例如查詢 IIS 中，url 以 /en/app 開頭的 Request 有那些\n GET /_search { \u0026quot;query\u0026quot;: { \u0026quot;prefix\u0026quot;: { \u0026quot;iis.access.url\u0026quot;: \u0026quot;/en/app\u0026quot; } } }    參考 Elastic 官網\n","description":"","id":2,"section":"posts","tags":["elastic"],"title":"如何使用 Kibana 分享日誌","uri":"https://reddtsai.github.io/zh/posts/elk_kibana/"},{"content":"版本\n Filebeat 6  環境\n Windows 10  1. 下載 Filebeat Download Filebeat for Windows\n2. 安裝 Filebeat 解壓縮至 C:\\Program Files\\Filebeat，以 admin 角色開啟 PowerShell\n1 2  cd \u0026#39;C:\\Program Files\\Filebeat\u0026#39; .\\install-service-filebeat.ps1   3. 設定 Filebeat 編輯 filebeat.yml，設定 elasticsearch 和 kibana 的位置\n1 2 3 4  output.elasticsearch: hosts: [\u0026#34;localhost:9200\u0026#34;] setup.kibana: host: \u0026#34;localhost:5601\u0026#34;   4. 設定 Filebeat 模組 收集 IIS Log\n編輯 filebeat\\module\\iis\\access\\manifest.yml\n1 2 3  default.paths: default: - C:/inetpub/logs/LogFiles/*/*.log   啟用 iis 模組\n1  .\\filebeat.exe modules enable iis   5. 啟動 Filebeat 服務 1 2  .\\filebeat.exe setup Start-Service filebeat   ","description":"","id":3,"section":"posts","tags":["elastic"],"title":"Windows 如何安裝 Filebeat","uri":"https://reddtsai.github.io/zh/posts/elk_windowsfilebeat/"},{"content":"版本\n ElastAlert 0.2  環境\n CentOS 7  安裝需求\n  python 2.7\n  python-dev\n  python-pip\n  dependency Package，參考 ElastAlert requirements.txt\n  1. 安裝 PIP、DEV 確認是否已安裝 python 2.7\n1  python --version   安裝 python-pip\n1 2 3 4 5 6 7 8 9  sudo yum -y install python-devel sudo yum -y install epel-release sudo yum -y install python-pip pip --version sudo pip install --upgrade pip   2. 安裝 ElastAlert 確認套件，安裝的過程中可能會遇到相依套件的問題，請參考 ElastAlert requirements.txt 中的需求套件清單\n1  pip list   例如，在安裝 blist 套件時，需要安裝 GCC\n1  sudo yum -y install gcc   例如，在更新 requests 套件時，需要強制移除安裝\n1  sudo pip install requests --ignore-installed requests   安裝 ElastAlert\n1  sudo pip install elastalert   3. 設定 ElastAlert 在 ElastAlert 目錄下新增設定檔 config.yaml。以我的環境為例 /usr/lib/python2.7/site-packages/elastalert\n建議複製 ElastAlert config.yaml.example\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28  # This is the folder that contains the rule yaml files# Any .yaml file will be loaded as a rulerules_folder:/usr/lib/python2.7/site-packages/elastalert/alert_rules# How often ElastAlert will query Elasticsearch# The unit can be anything from weeks to secondsrun_every:# seconds:minutes:1# hours:# ElastAlert will buffer results from the most recent# period of time, in case some log sources are not in real timebuffer_time:minutes:15# The Elasticsearch hostname for metadata writeback# Note that every rule can have its own Elasticsearch hostes_host:elasticsearch.example.com# The Elasticsearch portes_port:9200# elastalert-create-index to set a mappingwriteback_index:elastalert_statusalert_time_limit:days:2  4. 設定 Elasticsearch Client 確認 Elasticsearch Client 的版本和 Elasticsearch 的版本相符。以我的環境為例，需要將 lasticsearch Client 更新至 6.X 版\n1 2 3 4 5  pip list sudo pip uninstall elasticsearch sudo pip install \u0026#34;elasticsearch\u0026lt;7\u0026#34;   在 Elasticsearch 增加一個 ElastAlert 的索引\n1  elastalert-create-index   5. 設定通知規則 新增通知規則設定檔 filebeat_frequency.yaml。以我的環境為例 /usr/lib/python2.7/site-packages/elastalert/alert_rules\n這裡以 IIS Log 為例，當 http status != 200 時，發送一個訊息至 Slack\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27  es_host:elasticsearch.example.comes_port:9200name:Examplefrequencyruletype:frequencyindex:filebeat-*# (Required, frequency specific)# Alert when this many documents matching the query occur within a timeframenum_events:50# (Required, frequency specific)# num_events must occur within this amount of time to trigger an alerttimeframe:hours:4filter:- query:query_string:query:\u0026#34;NOT iis.access.response_code: 200 AND event.dataset: iis.access\u0026#34;alert:- slack:slack_webhook_url:\u0026#34;http://slack_webhook_url\u0026#34;  測試規則設定檔\n1  elastalert-test-rule alert_rules/filebeat_frequency.yaml   6. 設定 ElastAlert 服務 執行測試\n1  python -m elastalert --verbose --rule alert_rules/filebeat_frequency.yaml   新增服務\n1 2 3 4  sudo mkdir -p /etc/elastalert/rules cd /etc/elastalert/ sudo cp /usr/lib/python2.7/site-packages/elastalert/config.yaml config.yaml sudo cp /usr/lib/python2.7/site-packages/elastalert/alert_rules/filebeat_frequency.yaml rules/filebeat_frequency.yaml   修改 config.yaml\nrules_folder: /etc/elastalert/rules\n新增服務設定檔\n1 2  cd /etc/systemd/system/ sudo vi elastalert.service   elastalert.service\n1 2 3 4 5 6 7 8 9 10 11 12  [Unit] Description=elastalert [Service] Type=simple User=root Group=root Restart=on-failure WorkingDirectory=/usr/lib/python2.7/site-packages/elastalert ExecStart=/usr/bin/elastalert --config /etc/elastalert/config.yaml --rule /etc/elastalert/rules/filebeat_frequency.yaml [Install] WantedBy=multi-user.target   啟動服務\n1 2 3  sudo systemctl enable elastalert.service sudo systemctl start elastalert.service sudo systemctl status elastalert.service   參考 ElastAlert Repo\nElastAlert Doc\n","description":"","id":4,"section":"posts","tags":["elastic"],"title":"CentOS 7 如何安裝 ElastAlert","uri":"https://reddtsai.github.io/zh/posts/elk_centoselastalert/"},{"content":"歷史 Elastic 是由 Elasticsearch、Logstach 和 Kibana 這三個開源項目所組成，最初是由 Shay 編寫的 Elasticsearch 這個食譜搜尋引擎開始，後來與 Jordan 開發的 Logstach 和 Rashid 開發的 Kibana 共同合作。隨後推出一些商業服務並成立 Elastic 這個品牌。\nElasticsearch Elasticsearch 是個搜尋分析尋引擎，能夠集中儲存數據和分散運作，使用 RESTful 方式提供服務。\nLogstach Logstach 是個數據處理工具，將不同來源的資料轉化、解析或加密，然後將數據發送至指定的儲存體。\nKibana Kibana 為 Elastic 的介面(UI)，可用來管理配置 Elastic，或透過 DSL、SQL 查詢語法，將 Elasticsearch 數據分享。\n參考來源 Elastic 官網\n下篇文章會介紹如何利用 Elastic 處理日誌\n","description":"","id":5,"section":"posts","tags":["elastic"],"title":"Elastic 簡介","uri":"https://reddtsai.github.io/zh/posts/elk/"},{"content":"當你面對數個虛擬機、資料庫、成百的服務、應用程式生成的日誌，你需要一個能處理這巨量負雜日誌的產品，這裡介紹 Elastic 這個產品來協助你，必免自己造輪子。將由下圖的內容來說明，如何使用 Elastic 處理日誌你的日誌。\n日誌收集 首先是如何收集匯整你的日誌？例如你有 IIS、NGINX、MySQL、APP 多種不同類型的日誌，你需要將它們收集起來存放，這裡會使用 FileBeat 和 Logstash 來收集。\n FileBeat 是匯整轉發日誌工具，可使用它內建模組或自訂格式來收集日誌，並將收集來的數據解析發送到 Logstash 或 Elasticsearch 儲存。\n 範例如何使用 Filebeat 收集日誌\n  Logstash 是接收轉發日誌中介服務，從過濾器接收不同形式的來源，透過建構結構來分析轉換成通用格式，再輸出到 Elasticsearch 或其它儲存設備。\n日誌存儲 接下來透過 Elasticsearch 來儲存收集來的資料。\n Elasticsearch 是一個分散式、RESTful 風格的搜尋和數據分析引擎，它是 Elastic 的核心，很像資料庫提供搜索和儲存。\n 範例CentOS 7 如何安裝 Elasticsearch\n 日誌分析 Elastc 提供一個強大的 UI 介面 Kibana，它能協助你分析 視覺化、分享收集來的數據。\n Kibana 是個強大的 UI，透過網頁呈現，提供多種儀表皮和圖表來分享數據。\n 範例如何使用 Kibana 分享日誌\n 日誌監控 最後，Elastc 也提供數據、效能監控服務，這部分屬於白金服務需要付費，也有一些替代方，例如 ElastAlert、Sentinl。\n 範例CentOS 7 如何安裝 ElastAlert\n","description":"","id":6,"section":"posts","tags":["elastic"],"title":"如何利用 Elastic 處理日誌","uri":"https://reddtsai.github.io/zh/posts/elk_logging/"},{"content":"Filebeat 是個檔案分析工具，最常用來收集日誌檔，收集的過程分為\n  收集數據 (讀取日誌)\n  解析數據\n常見的日誌格式(IIS、NGINX、MySQL)大多可透過 Filebeat 內建模組來解析，也可透過新增模組來客製格式，以下會說明該如何新增或設定 Filebeat 模組。\n  傳送數據 (Logstash 或 Elasticsearch 儲存)\n   版本\n Filebeat 6  安裝請參考下一篇文章Windows 如何安裝 Filebeat\n 設定模組 Filebeat 提供多樣模組來收集常見的日誌，這邊以 IIS 日誌為例，說明如何設定模組。\n  設定日誌路徑\n編輯 [Windows 安裝路徑]\\filebeat\\module\\iis\\access\\manifest.yml\n #加入 IIS 日誌路徑 default.paths: default: - C:/inetpub/logs/LogFiles/*/*.log    啟用模組\n開啟 IIS 模組，在 PowerShell 執行下方命令\n cd [Windows 安裝路徑] .\\filebeat.exe modules enable iis    新增模組 新增一個模組後，可看到所產生的檔案結構，以下方我所建立的 nlog module 為例\nfilebeat ├ module │ ⎩ nlog │ ⎩ app │ ├ manifest.yaml │ ├ config │ │ ⎩ fileset.yml │ ⎩ ingest │ ⎩ pipeline.json ├ modules.d │ ⎩ nlog.yml.disabled   新增一個模組需透過 Beats 程式碼來逹成，這裡只會說明新模組需要作那些設定，完整資訊請參考 github Beats repository\n   manifest.yaml\nmanifest 控制檔，設定模組參考位置\n #日誌路徑 var: － name: paths os.windows － C:/log/*.log #template 參考路徑 input: config/fileset.yml #Ingest Pipeline 參考路徑 ingest_pipeline: ingest/pipeline.json    fileset.yml\nfileset 輸入組態檔，設定輸入位置、排除輸入檔案、排除輸入行及多行組合\n #排除 .gz 檔 exclude_files: [\u0026quot;.gz$\u0026quot;]    pipeline.json\nlasticsearch ingest node pipeline configurations\n  modules.yml.disabled\n模組開關\n  測試模組 新增或設定好模組，先由測試確認完後再上線\n  測試設定檔\n .\\filebeat.exe test config -c filebeat.yml .\\filebeat.exe test output filebeat.yml    執行 Filebeat\n .\\filebeat.exe -e -c filebeat.yml -d \u0026quot;*\u0026quot;   注意\n請先清除前次測試所讀取的記錄，刪除目錄 filebeat\\data\\registry\n   檢查 Ingest \u0026amp; Pipeline\n透過 elasticsearch api 查詢 Ingest \u0026amp; pipeline (例如 IIS 模組 pipeline filebeat-6.7.0-iis-access-default)\n curl -X GET http://elasticsearch:9200/_cat/indices?v curl -X GET http://elasticsearch:9200/_ingest/pipeline curl -X GET http://elasticsearch:9200/_ingest/pipeline/filebeat-6.7.0-iis-access-default   如果測試 pipeline 有問題，需要刪除舊的 pipeline.json\n  curl -X DELETE http://elasticsearch:9200/_ingest/pipeline/filebeat-6.7.0-iis-access-default    確認資料\n開啟 Kibana，透過 Logs 介面，確認是否有顯示 log 資料\n  參考 Elastic 官網\n","description":"","id":7,"section":"posts","tags":["elastic"],"title":"如何使用 Filebeat 收集日誌","uri":"https://reddtsai.github.io/zh/posts/elk_iisfilebeat/"},{"content":"版本\n Kibana 6.8  環境\n CentOS 7  1. 安裝 OpenJDK 1 2  sudo yum install java-1.8.0-openjdk-devel java -version   2. 安裝 Elasticsearch 簽章公鑰 1  rpm --import https://artifacts.elastic.co/GPG-KEY-elasticsearch   3. 安裝 Kibana 建立 Kibana 套件容器設定檔 /etc/yum.repos.d/kibana.repo\n填入套件容器參數\n1 2 3 4 5 6 7 8  [kibana-6.x] name=Kibana repository for 6.x packages baseurl=https://artifacts.elastic.co/packages/6.x/yum gpgcheck=1 gpgkey=https://artifacts.elastic.co/GPG-KEY-elasticsearch enabled=1 autorefresh=1 type=rpm-md   安裝 kibana\n1  sudo yum install kibana   4. 配置 kibana kibana 配置檔 /etc/kibana/kibana.yml\n1 2 3  elasticsearch.hosts: http://localhost:9200 server.host: 0.0.0.0   5. 設定防火牆和IP 新增\n1 2 3 4 5  sudo firewall-cmd --new-zone=kibana --permanent sudo firewall-cmd --reload sudo firewall-cmd --zone=kibana --add-source=\u0026lt;IP_ADDRESS\u0026gt;/32 --permanent sudo firewall-cmd --zone=kibana --add-port=5601/tcp --permanent sudo firewall-cmd --reload   修改\n1 2  sudo firewall-cmd --zone=kibana --add-source=\u0026lt;IP_ADDRESS\u0026gt; --permanent sudo firewall-cmd --reload   測試\n1 2 3  sudo firewall-cmd --zone=kibana --list-all sudo netstat -plnt   6. 啟動 kibana 服務 1 2  sudo systemctl enable kibana.service sudo systemctl start kibana.service   測試 kibana\nhttp://localhost:5601\n1  sudo systemctl status kibana.service   也可檢查服務記錄訊息\n1  sudo journalctl --unit kibana --since \u0026#34;20 min ago\u0026#34;   參考 Elastic 官網\n","description":"","id":8,"section":"posts","tags":["elastic"],"title":"CentOS 7 如何安裝 Kibana","uri":"https://reddtsai.github.io/zh/posts/elk_centoskibana/"},{"content":"版本\n Elasticsearch 6.8  環境\n CentOS 7  1. 安裝 OpenJDK 1 2  sudo yum install java-1.8.0-openjdk-devel java -version   2. 安裝 Elasticsearch 簽章公鑰 1  rpm --import https://artifacts.elastic.co/GPG-KEY-elasticsearch   3. 安裝 Elasticsearch 建立 Elasticsearch 套件容器設定檔 /etc/yum.repos.d/elasticsearch.repo\n填入套件容器參數\n1 2 3 4 5 6 7 8  [elasticsearch-6.x] name=Elasticsearch repository for 6.x packages baseurl=https://artifacts.elastic.co/packages/6.x/yum gpgcheck=1 gpgkey=https://artifacts.elastic.co/GPG-KEY-elasticsearch enabled=1 autorefresh=1 type=rpm-md   安裝 Elasticsearch\n1  sudo yum install elasticsearch   4. 啟動 Elasticsearch 服務 1 2  sudo systemctl enable elasticsearch.service sudo systemctl start elasticsearch.service   測試 Elasticsearch\n1 2 3  sudo systemctl status elasticsearch.service curl -X GET http://localhost:9200   也可檢查服務記錄訊息\n1  sudo journalctl --unit elasticsearch --since \u0026#34;20 min ago\u0026#34;   5. 設定防火牆和IP 新增\n1 2 3 4 5  sudo firewall-cmd --new-zone=elasticsearch --permanent sudo firewall-cmd --reload sudo firewall-cmd --zone=elasticsearch --add-source=\u0026lt;IP_ADDRESS\u0026gt;/32 --permanent sudo firewall-cmd --zone=elasticsearch --add-port=9200/tcp --permanent sudo firewall-cmd --reload   修改\n1 2  sudo firewall-cmd --zone=elasticsearch --add-source=\u0026lt;IP_ADDRESS\u0026gt; --permanent sudo firewall-cmd --reload   測試\n1 2 3  sudo firewall-cmd --zone=kibana --list-all sudo netstat -plnt   6. 配置 Elasticsearch Elasticsearch 配置檔 /etc/elasticsearch/elasticsearch.yml\nElasticsearch JVM 配置檔 /etc/elasticsearch/jvm.options\n✳︎記憶體配置不可小放實體記憶體50%\n1 2 3 4  -Xms2g -Xmx2g network.host: 0.0.0.0   參考 Elastic 官網\n參考官方說明\n","description":"","id":9,"section":"posts","tags":["elastic"],"title":"CentOS 7 如何安裝 Elasticsearch","uri":"https://reddtsai.github.io/zh/posts/elk_centoselastic/"},{"content":"Hello Hugo hello!!!\n","description":"","id":10,"section":"posts","tags":null,"title":"Hello","uri":"https://reddtsai.github.io/zh/posts/hello/"}]